<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dynamic Average Color Player</title>

<style>
body {
    margin: 0;
    padding: 20px;
    background: #121212;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    transition: background 0.8s ease;
}

/* 卡片 */
.card {
    width: 100%;
    max-width: 600px;
    background: #181818;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
}

/* 封面 */
.cover {
    width: 90px;
    height: 90px;
    border-radius: 8px;
    object-fit: cover;
    flex-shrink: 0;
}

/* 信息 */
.info {
    flex: 1;
    min-width: 0;
}

.title {
    color: white;
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 4px;
}

.artist {
    color: #b3b3b3;
    font-size: 13px;
    margin-bottom: 10px;
}

audio {
    width: 100%;
    filter: invert(1);
}
</style>
</head>

<body>

<div class="card">
    <img src="src/hqdefault.jpg" class="cover" id="cover">

    <div class="info">
        <div class="title">さくらのうた（木管五重奏）</div>
        <div class="artist">福田洋介⧸森の五重奏団</div>

        <audio controls loop>
            <source src="src/BGM.m4a" type="audio/mp4">
        </audio>
    </div>
</div>

<script>
const img = document.getElementById('cover');

img.onload = function() {

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    const size = 100; // 降低分辨率提高性能
    canvas.width = size;
    canvas.height = size;

    ctx.drawImage(img, 0, 0, size, size);

    const imageData = ctx.getImageData(0, 0, size, size);
    const data = imageData.data;

    let r = 0, g = 0, b = 0;
    let count = 0;

    for (let i = 0; i < data.length; i += 4) {
        r += data[i];
        g += data[i + 1];
        b += data[i + 2];
        count++;
    }

    r = Math.floor(r / count);
    g = Math.floor(g / count);
    b = Math.floor(b / count);

    // 压暗 40% 避免太亮
    r = Math.floor(r * 0.6);
    g = Math.floor(g * 0.6);
    b = Math.floor(b * 0.6);

    document.body.style.background =
        `linear-gradient(135deg, rgb(${r},${g},${b}), #121212)`;
};
</script>

</body>
</html>
